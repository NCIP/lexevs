<beans xmlns="http://www.springframework.org/schema/beans"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xmlns:util="http://www.springframework.org/schema/util"
   xmlns:aop="http://www.springframework.org/schema/aop"
   xmlns:tx="http://www.springframework.org/schema/tx"
   xsi:schemaLocation="
   http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd
   http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
   http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
   http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd">
	
	<import resource="classpath:lexevsCache.xml"/>

	 <bean id="sqlMap"
          class="org.springframework.orm.ibatis.SqlMapClientFactoryBean">
       		 <property name="configLocation" value="classpath:ibatis/v20/v20SqlMaps.xml"/>
        <property name="dataSource" ref="dataSource" />
        <property name="sqlMapClientProperties">
        	<map>
        		<entry key="defaultPrefix">
        			<ref bean="dbPrefix"/>
        		</entry>
        	</map>
        </property>
    </bean>   

	<bean id="defaultRootBuilder" class="org.lexevs.dao.database.operation.root.DefaultRootBuilder">
		<property name="databaseServiceManager" ref="databaseServiceManager"/>
		<property name="systemResourceService" ref="delegatingResourceManagingService"/>
	</bean>
	
	<bean id="defaultTransitivityBuilder" 
		class="org.lexevs.dao.database.operation.transitivity.DefaultTransitivityBuilder">
		<property name="databaseServiceManager" ref="databaseServiceManager"/>
		<property name="systemResourceService" ref="delegatingResourceManagingService"/>
		<property name="logger" ref="loggerFactory"/>
		<property name="registry" ref="registry"/>
	</bean>
    
    <bean id="abstractIbatisDao" abstract="true">
    	<property name="sqlMapClientTemplate" ref="sqlMapClientTemplate"/>
		<property name="prefixResolver" ref="defaultPrefixResolver"/>
		<property name="primaryKeyIncrementer" ref="primaryKeyIncrementer"/>
    </bean>
	
	<bean id="ibatisPropertyDao"
		class="org.lexevs.dao.database.ibatis.property.IbatisPropertyDao" parent="abstractIbatisDao">
		<property name="ibatisVersionsDao" ref="ibatisVersionsDao"/>
	</bean>
    
    <bean id="ibatisCodingSchemeDao"
		class="org.lexevs.dao.database.ibatis.codingscheme.IbatisCodingSchemeDao" parent="abstractIbatisDao">
		<property name="versionsDao" ref="ibatisVersionsDao"/>
		<property name="entityDao" ref="ibatisEntityDao"/>
		<property name="associationDao" ref="ibatisAssociationDao"/>
		<property name="propertyDao" ref="ibatisPropertyDao"/>
	</bean>
	
	<bean id="ibatisPickListDao"
		class="org.lexevs.dao.database.ibatis.valuesets.IbatisPickListDao" parent="abstractIbatisDao">
		<property name="versionsDao" ref="ibatisVersionsDao"/>
		<property name="vsEntryStateDao" ref="ibatisVSEntryStateDao"/>
		<property name="vsPropertyDao" ref="ibatisVSPropertyDao"/>
		<property name="pickListEntryNodeDao" ref="ibatisPickListEntryNodeDao"/>
	</bean>
	
	<bean id="ibatisPickListEntryNodeDao"
		class="org.lexevs.dao.database.ibatis.valuesets.IbatisPickListEntryNodeDao" parent="abstractIbatisDao">
		<property name="versionsDao" ref="ibatisVersionsDao"/>
		<property name="vsEntryStateDao" ref="ibatisVSEntryStateDao"/>
		<property name="vsPropertyDao" ref="ibatisVSPropertyDao"/>
	</bean>	
	
	<bean id="ibatisValueSetDefinitionDao"
		class="org.lexevs.dao.database.ibatis.valuesets.IbatisValueSetDefinitionDao" parent="abstractIbatisDao">
		<property name="versionsDao" ref="ibatisVersionsDao"/>
		<property name="vsDefinitionEntryDao" ref="ibatisVSDefinitionEntryDao"/>
		<property name="vsPropertyDao" ref="ibatisVSPropertyDao"/>
		<property name="vsEntryStateDao" ref="ibatisVSEntryStateDao"/>
	</bean>

	<bean id="ibatisVSDefinitionEntryDao"
		class="org.lexevs.dao.database.ibatis.valuesets.IbatisVSDefinitionEntryDao" parent="abstractIbatisDao">
		<property name="vsPropertyDao" ref="ibatisVSPropertyDao"/>
		<property name="vsEntryStateDao" ref="ibatisVSEntryStateDao"/>
	</bean>

	<bean id="ibatisVSPropertyDao"
		class="org.lexevs.dao.database.ibatis.valuesets.IbatisVSPropertyDao" parent="abstractIbatisDao">
		<property name="ibatisVersionsDao" ref="ibatisVersionsDao"/>
		<property name="vsEntryStateDao" ref="ibatisVSEntryStateDao"/>
	</bean>
	
	<bean id="ibatisVSEntryStateDao"
		class="org.lexevs.dao.database.ibatis.valuesets.IbatisVSEntryStateDao" parent="abstractIbatisDao">
		<property name="ibatisRevisionDao" ref="ibatisRevisionDao"/>
	</bean>
	
	<bean id="abstractSqlInterfaceDao" abstract="true">
		<property name="resourceManager" ref="resourceManager"/>
	 	<property name="sqlImplementedMethodsDao" ref="sqlImplementedMethodsDao"/>
	</bean>
	
	 <bean id="sqlInterfaceCodingSchemeDao" 
	 	class="org.lexevs.dao.database.sqlimplementedmethods.codingscheme.SQLInterfaceCodingSchemeDao" 
	 	parent="abstractSqlInterfaceDao"/>
	 
	 <bean id="sqlImplementedMethodsDao" class="org.lexevs.dao.database.sqlimplementedmethods.SQLImplementedMethodsDao">
	 	<property name="resourceManager" ref="resourceManager"/>
	 	<property name="logger" ref="loggerFactory"/>
	 </bean>
	 
	 <bean id="sqlInterfaceEntityDao" class="org.lexevs.dao.database.sqlimplementedmethods.entity.SQLInterfaceEntityDao"
		 parent="abstractSqlInterfaceDao"/>

	<bean id="daoManager" class="org.lexevs.dao.database.access.DaoManager">
		<property name="codingSchemeDaos">
			<list>
				<ref bean="ibatisCodingSchemeDao"/>
				<ref bean="sqlInterfaceCodingSchemeDao"/>
			</list>
		</property>
		<property name="entityDaos">
			<list>
				<ref bean="ibatisEntityDao"/>
				<ref bean="sqlInterfaceEntityDao"/>
			</list>
		</property>
		<property name="associationDaos">
			<list>
				<ref bean="ibatisAssociationDao"/>
			</list>
		</property>
		<property name="associationTargetDaos">
			<list>
				<ref bean="ibatisAssociationTargetDao"/>
			</list>
		</property>
		<property name="associationDataDaos">
			<list>
				<ref bean="ibatisAssociationDataDao"/>
			</list>
		</property>
		<property name="propertyDaos">
			<list>
				<ref bean="ibatisPropertyDao"/>
			</list>
		</property>
		<property name="codedNodeGraphDaos">
			<list>
				<ref bean="ibatisCodedNodeGraphDao"/>
			</list>
		</property>		
		<property name="pickListDaos">
			<list>
				<ref bean="ibatisPickListDao"/>
			</list>
		</property>		
		<property name="pickListEntryNodeDaos">
			<list>
				<ref bean="ibatisPickListEntryNodeDao"/>
			</list>
		</property>			
		<property name="valueSetDefinitionDaos">
			<list>
				<ref bean="ibatisValueSetDefinitionDao"/>
			</list>
		</property>
		<property name="vsDefinitionEntryDaos">
			<list>
				<ref bean="ibatisVSDefinitionEntryDao"/>
			</list>
		</property>		
		<property name="vsPropertyDaos">
			<list>
				<ref bean="ibatisVSPropertyDao"/>
			</list>
		</property>
		<property name="vsEntryStateDaos">
			<list>
				<ref bean="ibatisVSEntryStateDao"/>
			</list>
		</property>		
		<property name="versionsDaos">
			<list>
				<ref bean="ibatisVersionsDao" />
			</list>
		</property>
		<property name="systemReleaseDaos">
			<list>
				<ref bean="ibatisSystemReleaseDao" />
			</list>
		</property>
		<property name="revisionDaos">
			<list>
				<ref bean="ibatisRevisionDao" />
			</list>
		</property>
		<property name="nciHistoryDaos">
			<list>
				<ref bean="ibatisNciHistoryDao" />
			</list>
		</property>
	
		<property name="registry" ref="registry"/>
		<property name="currentVersion" ref="persistenceSchemeVersion"/>
	</bean>
	
	 <bean id="ibatisEntityDao"
		class="org.lexevs.dao.database.ibatis.entity.IbatisEntityDao" parent="abstractIbatisDao">
		<property name="ibatisVersionsDao" ref="ibatisVersionsDao"/>
		<property name="ibatisCodingSchemeDao" ref="ibatisCodingSchemeDao"/>
		<property name="ibatisPropertyDao" ref="ibatisPropertyDao"/>
		<property name="ibatisAssociationDao" ref="ibatisAssociationDao"/>
	</bean>
	
	<bean id="ibatisCodedNodeGraphDao"
		class="org.lexevs.dao.database.ibatis.codednodegraph.IbatisCodedNodeGraphDao" parent="abstractIbatisDao"/>
	
	<bean id="ibatisAssociationDao"
		class="org.lexevs.dao.database.ibatis.association.IbatisAssociationDao" parent="abstractIbatisDao">
		<property name="ibatisVersionsDao" ref="ibatisVersionsDao"/>
		<property name="associationTargetDao" ref="ibatisAssociationTargetDao"/>
		<property name="associationDataDao" ref="ibatisAssociationDataDao"/>
		<property name="propertyDao" ref="ibatisPropertyDao"/>
	</bean>

	<bean id="ibatisAssociationTargetDao"
		class="org.lexevs.dao.database.ibatis.association.IbatisAssociationTargetDao"
		parent="abstractIbatisDao">
		<property name="versionsDao" ref="ibatisVersionsDao" />
	</bean>
	
    <bean id="ibatisAssociationDataDao"
		class="org.lexevs.dao.database.ibatis.association.IbatisAssociationDataDao" parent="abstractIbatisDao">
		<property name="versionsDao" ref="ibatisVersionsDao"/>
	</bean>
    
    <bean id="ibatisVersionsDao"
		class="org.lexevs.dao.database.ibatis.versions.IbatisVersionsDao" parent="abstractIbatisDao">
		<property name="ibatisRevisionDao" ref="ibatisRevisionDao"/>
	</bean>
	
    <bean id="ibatisSystemReleaseDao"
		class="org.lexevs.dao.database.ibatis.systemRelease.IbatisSystemReleaseDao" parent="abstractIbatisDao">
	</bean>

	<bean id="ibatisRevisionDao"
		class="org.lexevs.dao.database.ibatis.revision.IbatisRevisionDao" parent="abstractIbatisDao">
		<property name="systemReleaseDao" ref="ibatisSystemReleaseDao"/>
	</bean>
	
	<bean id="ibatisNciHistoryDao"
		class="org.lexevs.dao.database.ibatis.ncihistory.IbatisNciHistoryDao" parent="abstractIbatisDao">
	</bean>

	<bean id="databaseServiceManager" class="org.lexevs.dao.database.service.DatabaseServiceManager">
		<property name="codingSchemeService" ref="codingSchemeService"/>
		<property name="propertyService" ref="propertyService"/>
		<property name="entityService" ref="entityService"/>
		<property name="relationService" ref="relationService"/>
		<property name="associationService" ref="associationService"/>
		<property name="associationTargetService" ref="associationTargetService"/>
		<property name="associationDataService" ref="associationDataService"/>
		<property name="pickListDefinitionService" ref="pickListDefinitionService"/>
		<property name="valueSetDefinitionService" ref="valueSetDefinitionService"/>
		<property name="vsPropertyService" ref="vsPropertyService"/>
		<property name="daoCallbackService" ref="daoManagerDaoCallbackService"/>
		<property name="codedNodeGraphService" ref="codedNodeGraphService"/>
		<property name="authoringService" ref="authoringService"></property>
		<property name="nciHistoryService" ref="nciHistoryService"/>
		<property name="listenerRegistry" ref="extensionLoadingListenerRegistry"/>
	</bean>
	
	<bean id="extensionLoadingListenerRegistry" 
		class="org.lexevs.dao.database.service.event.registry.ExtensionLoadingListenerRegistry">
		<property name="logger" ref="loggerFactory"/>
		<property name="myClassLoader" ref="myClassLoader"/>
		<property name="databaseServiceEventListeners">
			<list>
				<ref bean="codingSchemeRegisteringListener"/>
				<bean class="org.lexevs.dao.database.service.listener.LuceneEntityPropertyInsertListener"/>
				<bean class="org.lexevs.dao.database.service.listener.LuceneEntityPropertyUpdateListener"/>
				<bean class="org.lexevs.dao.database.service.listener.LuceneEntityPropertyRemoveListener"/>
				<bean class="org.lexevs.dao.database.service.listener.SystemResourceRefreshingListener"/>	
				<bean class="org.lexevs.dao.database.service.listener.LuceneEntityInsertListener"/>
				<bean class="org.lexevs.dao.database.service.listener.LuceneEntityUpdateListener"/>
				<bean class="org.lexevs.dao.database.service.listener.LuceneEntityRemoveListener"/>
				<bean class="org.lexevs.dao.database.service.listener.HistoryTableReplicatingListener"/>
				<bean class="org.lexevs.dao.database.service.listener.NullEntityNamespaceListener"/>
				<bean class="org.lexevs.dao.database.service.listener.NullAssociationNamespaceListener"/>
				<bean class="org.lexevs.dao.database.service.listener.InvalidPropertyLinkListener"/>
				<bean class="org.lexevs.dao.database.service.listener.DuplicatePropertyIdListener"/>
				<bean class="org.lexevs.dao.database.service.listener.DefaultLanguageAddingListener"/>
			</list>
		</property>
	</bean>
	
	<bean id="abstractService" class="org.lexevs.dao.database.service.event.DatabaseServiceEventSupport"
		abstract="true">
		<property name="daoManager" ref="daoManager"/>
		<property name="logger" ref="loggerFactory"/>
		<property name="listenerRegistry" ref="extensionLoadingListenerRegistry"/>
	</bean>
	
	<bean id="daoManagerDaoCallbackService" 
		class="org.lexevs.dao.database.service.daocallback.DaoManagerDaoCallbackService">
		<property name="daoManager" ref="daoManager"/>
	</bean>

	<bean id="authoringService" 
		class="org.lexevs.dao.database.service.version.VersionableEventAuthoringService"
		parent="abstractService">
		<property name="codingSchemeService" ref="codingSchemeService"/>
		<property name="valueSetDefinitionService" ref="valueSetDefinitionService"/>
		<property name="pickListDefinitionService" ref="pickListDefinitionService"/>
	</bean>
	
	<bean id="relationService" 
		class="org.lexevs.dao.database.service.relation.VersionableEventRelationService"
		parent="abstractService">
		<property name="assocTargetService" ref="associationTargetService"/>
		<property name="assocDataService" ref="associationDataService"/>
		<property name="propertyService" ref="propertyService"/>
	</bean>
	
	<bean id="codingSchemeService" 
		class="org.lexevs.dao.database.service.codingscheme.VersionableEventCodingSchemeService"
		parent="abstractService">
		<property name="propertyService" ref="propertyService"/>
		<property name="entityService" ref="entityService"/>
		<property name="relationService" ref="relationService"/>
	</bean>
		
	<bean id="propertyService" 
		class="org.lexevs.dao.database.service.property.VersionableEventPropertyService"
		parent="abstractService">
	</bean>
		
	<bean id="entityService" 
		class="org.lexevs.dao.database.service.entity.VersionableEventEntityService"
		parent="abstractService">
		<property name="propertyService" ref="propertyService"/>
	</bean>
	
	<bean id="codedNodeGraphService"
		class="org.lexevs.dao.database.service.codednodegraph.VersionableEventCodedNodeGraphService"
		parent="abstractService"/>
	
	<bean id="associationService" 
		class="org.lexevs.dao.database.service.association.VersionableEventAssociationService"
		parent="abstractService">
		<property name="propertyService" ref="propertyService"/>
	</bean>
	
	<bean id="associationTargetService" 
		class="org.lexevs.dao.database.service.association.VersionableEventAssociationTargetService"
		parent="abstractService">
	</bean>
	
	<bean id="associationDataService" 
		class="org.lexevs.dao.database.service.association.VersionableEventAssociationDataService"
		parent="abstractService">
	</bean>
		
	<bean id="pickListDefinitionService" 
		class="org.lexevs.dao.database.service.valuesets.VersionableEventPickListDefinitionService"
		parent="abstractService">
		<property name="vsPropertyService" ref="vsPropertyService"/>
		<property name="pickListEntryNodeService" ref="pickListEntryNodeService"/>
	</bean>
	
	<bean id="pickListEntryNodeService" 
		class="org.lexevs.dao.database.service.valuesets.VersionableEventPickListEntryNodeService"
		parent="abstractService">
		<property name="vsPropertyService" ref="vsPropertyService"/>
	</bean>
	
	<bean id="valueSetDefinitionService" 
		class="org.lexevs.dao.database.service.valuesets.VersionableEventValueSetDefinitionService"
		parent="abstractService">
		<property name="vsDefinitionEntryService" ref="vsDefinitionEntryService"/>
		<property name="vsPropertyService" ref="vsPropertyService"/>
	</bean>
	
	<bean id="vsDefinitionEntryService" 
		class="org.lexevs.dao.database.service.valuesets.VersionableEventVSDefinitionEntryService"
		parent="abstractService">
	</bean>
	
	<bean id="vsPropertyService" 
		class="org.lexevs.dao.database.service.valuesets.VersionableEventVSPropertyService"
		parent="abstractService">
	</bean>
	
	<bean id="nciHistoryService" 
		class="org.lexevs.dao.database.service.ncihistory.VersionableEventNciHistoryService"
		parent="abstractService"/>
	
	<bean id="lexEvsJdbcTemplate"
		class="org.springframework.jdbc.core.JdbcTemplate">
		<property name="dataSource">
			<ref bean="dataSource" />
		</property>
	</bean>
	
	<bean id="sqlMapClientTemplate" class="org.springframework.orm.ibatis.SqlMapClientTemplate">
		<property name="dataSource" ref="dataSource"/>
		<property name="sqlMapClient" ref="sqlMap"/>
	</bean>
    
    <bean id="abstractResourceManagerVariableFactory" 
     	class="org.lexevs.system.constants.IndividualVariableFactory"
     	abstract="true">
     	<property name="bean" ref="resourceManager"/>
     </bean>
    
     <bean id="transactionManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager">  
   		<property name="sessionFactory">
    		<ref local="registrySessionFactory"/>
 		 </property>
	</bean>
	
	<bean id="defaultPrefixResolver" class="org.lexevs.dao.database.prefix.DefaultPrefixResolver">
		<property name="systemVariables" ref="systemVariables"/> 
		<property name="registry" ref="registry"/>
		<property name="databaseServiceManager" ref="databaseServiceManager"/>
	</bean>
	
	<bean id="hibernateRegistryDao" class="org.lexevs.dao.database.hibernate.registry.HibernateRegistryDao">
		<property name="sessionFactory" ref="registrySessionFactory"/>
	</bean>
	
	<bean id="unPooledDataSource" class="org.springframework.jdbc.datasource.SimpleDriverDataSource" >
		<property name="driverClass" ref="jdbcDriverClass" />
		<property name="url" ref="dbUrl" />
		<property name="username" ref="dbUser"/>
		<property name="password" ref="dbPassword"/>
	</bean>
	
	<bean id="validationQueryFactory"
		class="org.lexevs.dao.database.utility.DatabaseValidationQueryFactory">
			<property name="dbUrl" ref="dbUrl"/>
	</bean>
	
	<bean id="jdbcDriverClass" class="org.lexevs.dao.database.utility.JdbcDriverBootstrap">
		<property name="classLoader" ref="myClassLoader"/>
		<property name="driverClass" ref="dbDriver" />
		<property name="systemVariables" ref="systemVariables" />
		<property name="logger" ref="loggerFactory" />
	</bean>
	
	 <bean id="dsConnectionFactory" class="org.apache.commons.dbcp.DataSourceConnectionFactory">
        <constructor-arg><ref bean="unPooledDataSource"/></constructor-arg>
    </bean>
    
    <bean id="myClassLoader" class="org.lexevs.system.utility.MyClassLoader">
    	<constructor-arg ref="systemVariables"/>
    	<constructor-arg ref="loggerFactory"/>
    </bean>
	
	<bean id="pool" class="org.apache.commons.pool.impl.GenericObjectPool" destroy-method="close">
		<property name="maxActive" ref="dbConnections"/>
		<property name="testOnBorrow" value="true"/>
		<property name="whenExhaustedAction" value="2"/>
    </bean>
    
	<bean id="poolableConnectionFactory" class="org.apache.commons.dbcp.PoolableConnectionFactory">
        <constructor-arg index="0"><ref bean="dsConnectionFactory"/></constructor-arg>
        <constructor-arg index="1"><ref bean="pool"/></constructor-arg>
        <constructor-arg index="2"><null/></constructor-arg>
        <constructor-arg index="3" ref="validationQueryFactory"/>
        <constructor-arg index="4"><value>false</value></constructor-arg>
        <constructor-arg index="5"><value>true</value></constructor-arg>
    </bean>
    
    <bean id="loggerFactory" class="org.lexevs.logging.LoggerFactory" factory-method="getLogger"/>
    
    <bean id="systemVariables" class="org.lexevs.system.constants.SystemVariables">
    	<constructor-arg ref="loggerFactory"/>
    </bean>
    
     <bean id="abstractSystemVariableFactory" 
     	class="org.lexevs.system.constants.IndividualVariableFactory"
     	abstract="true">
     	<property name="bean" ref="systemVariables"/>
     </bean>
    
     <bean id="dbUrl" class="org.lexevs.dao.database.jdbc.MysqlJdbcUrlAppendingFactory">
     	<property name="systemVariables" ref="systemVariables"/>
     </bean>
    
    <bean id="dbPassword" parent="abstractSystemVariableFactory">
    	<property name="variableName" value="AutoLoadDBPassword"/>
    </bean>
    
    <bean id="dbUser" parent="abstractSystemVariableFactory">
    	<property name="variableName" value="AutoLoadDBUsername"/>
    </bean>
    
    <bean id="dbDriver" parent="abstractSystemVariableFactory">
    	<property name="variableName" value="AutoLoadDBDriver"/>
    </bean>
    
    <bean id="dbPrefix" parent="abstractSystemVariableFactory">
    	<property name="variableName" value="AutoLoadDBPrefix"/>
    </bean>
    
    <bean id="dbConnections" parent="abstractSystemVariableFactory">
    	<property name="variableName" value="MaxConnectionsPerDB"/>
    </bean>
    
    <bean id="dbcpDataSource" class="org.apache.commons.dbcp.PoolingDataSource" depends-on="poolableConnectionFactory">
        <constructor-arg><ref bean="pool"/></constructor-arg>
    </bean>
    
    <bean id="dataSource" 
    	class="org.lexevs.dao.database.datasource.ErrorReportingDataSourceDecorator">
    	<constructor-arg ref="dbcpDataSource"/>
    	<property name="systemVariables" ref="systemVariables"/>
		<property name="logger" ref="loggerFactory"/>
    </bean>
    
    <bean id="persistenceSchemeVersion" class="org.lexevs.dao.database.scheme.CurrentPersistenceSchemeVersionFactory">
    	<property name="systemVariables" ref="systemVariables"/>
    </bean>
    
    <bean id="defaultVersion20Scheme" class="org.lexevs.dao.database.scheme.DefaultVersion20Scheme">
    	<property name="lexEvsDatabaseSchemaSetup" ref="lexEvsSchemaInstallationSetup"/>
    	
    </bean>
    
    <bean id="persistenceScheme" class="org.lexevs.dao.database.scheme.PersistenceSchemeFactory">
    	<property name="logger" ref="loggerFactory"/>
    	<property name="myClassLoader" ref="myClassLoader"/>
    	<property name="currentPersistenceScheme" ref="persistenceSchemeVersion"/>
    	<property name="persistenceSchemes">
			<list>
				<ref bean="defaultVersion20Scheme"/>
			</list>
		</property>
    </bean>  
    
    <bean id="primaryKeyIncrementer" 
    	class="org.lexevs.dao.database.key.incrementer.PrimaryKeyIncrementerFactory">
    	<property name="systemVariables" ref="systemVariables"/>
    	<property name="databaseType" ref="databaseTypeFactory"/>
    	<property name="primaryKeyIncrementers">
			<list>
				<bean class="org.lexevs.dao.database.key.incrementer.RandomGuidKeyIncrementer"/>
				<ref bean="sequenceBasedBigIntKeyIncrementer"/>
				<ref bean="mysqlTableBasedBigIntKeyIncrementer"/>
			</list>
		</property>
    </bean>
    
    <bean id="mysqlTableBasedBigIntKeyIncrementer" class="org.lexevs.dao.database.key.incrementer.MysqlTableBasedBigIntKeyIncrementer">
   		<property name="databaseUtility" ref="defaultDatabaseUtility" />
   		<property name="dataSource" ref="dataSource"/>
   		<property name="prefixResolver" ref="defaultPrefixResolver"/>
    </bean>
    
    <bean id="sequenceBasedBigIntKeyIncrementer" class="org.lexevs.dao.database.key.incrementer.SequenceBasedBigIntKeyIncrementer">
    	<property name="dataSource" ref="dataSource"/>
    	<property name="databaseType" ref="databaseTypeFactory"/>
    	<property name="prefixResolver" ref="defaultPrefixResolver"/>
    </bean>
    
    <bean id="defaultLexEvsDatabaseOperations" class="org.lexevs.dao.database.operation.DefaultLexEvsDatabaseOperations">
   	 	<property name="databaseUtility" ref="defaultDatabaseUtility" />
   		<property name="prefixResolver" ref="defaultPrefixResolver"/>
   		<property name="dataSource" ref="dataSource"/>
   		<property name="databaseType" ref="databaseTypeFactory"/>
   		<property name="transactionManager" ref="transactionManager"/>
   		<property name="transitivityBuilder" ref="defaultTransitivityBuilder"/>
   		<property name="rootBuilder" ref="defaultRootBuilder"/>
   		<property name="systemVariables" ref="systemVariables"/>
   		<property name="primaryKeyIncrementer" ref="primaryKeyIncrementer"/>
   		
   		<property name="commonXmlDdl" value="classpath:sql/lexevs/common-schema.xml"/>
   		<property name="nciHistoryXmlDdl" value="classpath:sql/lexevs/ncihistory-schema.xml"/>
   		<property name="valueSetXmlDdl" value="classpath:sql/lexevs/valueset-schema.xml"/>
   		<property name="valueSetHistoryXmlDdl" value="classpath:sql/lexevs/valuesethistory-schema.xml"/>
   		<property name="codingSchemeHistoryXmlDdl" value="classpath:sql/lexevs/codingschemehistory-schema.xml"/>
   		<property name="codingSchemeXmlDdl" value="classpath:sql/lexevs/codingscheme-schema.xml"/>
   	 </bean>
   	 
   	<bean id="lexevsHistoryCreateScript"
		class="org.lexevs.dao.database.setup.script.ScriptFactory">
		<property name="scriptType" value="create"/>
		<property name="databaseType" ref="databaseTypeFactory"/>
		<property name="creationScriptPrefix" value="sql/lexevs/codingschemehistory-create-"/>
	</bean>
   	 
	<bean id="lexevsValueSetHistoryCreateScript"
		class="org.lexevs.dao.database.setup.script.ScriptFactory">
		<property name="scriptType" value="create"/>
		<property name="databaseType" ref="databaseTypeFactory"/>
		<property name="creationScriptPrefix" value="sql/lexevs/valuesethistory-create-"/>
	</bean>
	
   	<bean id="lexevsCodingSchemeSchemaCreateScript"
		class="org.lexevs.dao.database.setup.script.ScriptFactory">
		<property name="scriptType" value="create"/>
		<property name="databaseType" ref="databaseTypeFactory"/>
		<property name="creationScriptPrefix" value="sql/lexevs/codingscheme-create-"/>
	</bean>
	
	<bean id="lexevsCodingSchemeSchemaDropScript"
		class="org.lexevs.dao.database.setup.script.ScriptFactory">
		<property name="scriptType" value="drop"/>
		<property name="databaseType" ref="databaseTypeFactory"/>
		<property name="dropScriptPrefix" value="sql/lexevs/codingscheme-drop-"/>
	</bean>
	
	<bean id="lexevsCommonSchemaCreateScript"
		class="org.lexevs.dao.database.setup.script.ScriptFactory">
		<property name="scriptType" value="create"/>
		<property name="databaseType" ref="databaseTypeFactory"/>
		<property name="creationScriptPrefix" value="sql/lexevs/common-create-"/>
	</bean>
	
	<bean id="lexevsValueSetsSchemaCreateScript"
		class="org.lexevs.dao.database.setup.script.ScriptFactory">
		<property name="scriptType" value="create"/>
		<property name="databaseType" ref="databaseTypeFactory"/>
		<property name="creationScriptPrefix" value="sql/lexevs/valuesets-create-"/>
	</bean>
	
	<bean id="lexevsNciHistorySchemaCreateScript"
		class="org.lexevs.dao.database.setup.script.ScriptFactory">
		<property name="scriptType" value="create"/>
		<property name="databaseType" ref="databaseTypeFactory"/>
		<property name="creationScriptPrefix" value="sql/lexevs/ncihistory-create-"/>
	</bean>
	
	<bean id="registryXmlToDatabaseTransfer" 
		class="org.lexevs.registry.xmltransfer.RegistryXmlToDatabaseTransfer">
		<property name="systemVariables" ref="systemVariables"/>
		<property name="databaseRegistry" ref="databaseRegistry"/>
		<property name="xmlRegistry" ref="xmlRegistry"/>
	</bean>
	
	<bean id="registrySessionFactory" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
		<property name="dataSource">
			<ref bean="dataSource" />
		</property>
		<property name="entityInterceptor" ref="prefixInterceptor"/>
		<property name="configLocations" value="classpath:hibernate/registry/hibernate.cfg.xml"/>
		<property name="configurationClass" value="org.hibernate.cfg.AnnotationConfiguration"/>	
	</bean>

	<bean id="prefixInterceptor" class="org.lexevs.dao.database.hibernate.prefix.PrefixInterceptor">
		<property name="prefixResolver" ref="defaultPrefixResolver"/>
	</bean>
	
	<bean id="databaseRegistry" class="org.lexevs.registry.service.DatabaseRegistry">
		<property name="registryDao" ref="hibernateRegistryDao"/>
		<property name="nextDatabasePrefixGenerator" ref="cyclingCharDbPrefixGenerator"/>
	</bean>
	
	<bean id="xmlRegistry" class="org.lexevs.registry.service.XmlRegistry">
		<constructor-arg ref="systemVariables"/>
		<property name="dataSource" ref="dataSource"/>
	</bean>
	
	<bean id="registry" class="org.lexevs.registry.service.DelegatingDatabaseToXmlRegistry">
		<property name="xmlRegistry" ref="xmlRegistry"/>
		<property name="databaseRegistry" ref="databaseRegistry"/>
	</bean>
	
	<bean id="cyclingCharDbPrefixGenerator" class="org.lexevs.dao.database.prefix.CyclingCharDbPrefixGenerator">
		<property name="registry" ref="databaseRegistry"/>
		<property name="prefixResolver" ref="defaultPrefixResolver"/>
	</bean>
	
	<bean id="resourceManager" class="org.lexevs.system.ResourceManager" init-method="init">
		<property name="systemVariables" ref="systemVariables"/>
		<property name="logger" ref="loggerFactory"/>
		<property name="dataSource" ref="dataSource"/>
		<property name="databaseType" ref="databaseTypeFactory"/>
		<property name="xmlRegistry" ref="xmlRegistry"/>
	</bean>
	
	<bean id="delegatingResourceManagingService" class="org.lexevs.system.service.DelegatingSystemResourceService">
		<property name="primarySystemResourceService" ref="lexEvsResourceManagingService"/>
		<property name="delegateSystemResourceService" ref="resourceManager"/>
	</bean>
	
	<bean id="lexEvsResourceManagingService" class="org.lexevs.system.service.LexEvsResourceManagingService" 
		parent="loggingBean" init-method="initialize">
		<property name="persistenceScheme" ref="persistenceScheme"/>
		<property name="prefixResolver" ref="defaultPrefixResolver"/>
		<property name="systemVariables" ref="systemVariables"/> 
		<property name="lexEvsDatabaseOperations" ref="defaultLexEvsDatabaseOperations"/>
		<property name="registry" ref="databaseRegistry"/>
		<property name="myClassLoader" ref="myClassLoader"/>
		<property name="databaseServiceManager" ref="databaseServiceManager"/>
		<property name="entityIndexService" ref="luceneEntityIndexService"/>
		<property name="metadataIndexService" ref="luceneMetadataIndexService"/>
	</bean>
	
	<bean id="lexEvsSchemaInstallationSetup" class="org.lexevs.registry.setup.LexEvsSchemaInstallationSetup"
		parent="loggingBean">
		<property name="lexGridSchemaInstalled" ref="lexGridSchemaCheckFactory"/>
		<property name="systemVariables" ref="systemVariables"/> 
		<property name="lexEvsDatabaseOperations" ref="defaultLexEvsDatabaseOperations"/>
		<property name="registryDao" ref="hibernateRegistryDao"/>
		<property name="primaryKeyIncrementer" ref="primaryKeyIncrementer"/>
	</bean>
	
    <bean id="defaultDatabaseUtility"
		class="org.lexevs.dao.database.utility.DefaultDatabaseUtility">
		<property name="dataSource" ref="dataSource" />
	</bean>
	
	<bean id="lexGridSchemaCheckFactory"
		class="org.lexevs.dao.database.setup.schemacheck.LexGridSchemaCheckFactory">
		<property name="dataSource" ref="dataSource"/>  
		<property name="databaseType" ref="databaseTypeFactory"/>  
		<property name="systemVariables" ref="systemVariables"/>
	</bean>
	
	<tx:annotation-driven proxy-target-class="true" transaction-manager="transactionManager"/>
	
	<bean id="databaseTypeFactory" class="org.lexevs.dao.database.type.DatabaseTypeFactory">
		<property name="dataSource" ref="dataSource"/> 
	</bean>
	
	<bean id="lexEvsServiceLocator" 
		class="org.lexevs.locator.LexEvsServiceLocator">
		<property name="resourceManager" ref="resourceManager"/>
		<property name="lexEvsDatabaseOperations" ref="defaultLexEvsDatabaseOperations"/>
		<property name="databaseServiceManager" ref="databaseServiceManager"/>
		<property name="systemResourceService" ref="delegatingResourceManagingService"/>
		<property name="registry" ref="registry"/>
		<property name="indexServiceManager" ref="indexServiceManager"/>
		<property name="cacheWrappingFactory" ref="cacheWrappingFactory"/>
		<property name="lexEvsIndexOperations" ref="defaultLexEvsIndexOperations"/>
	</bean>
	
	<bean id="loggingBean" class="org.lexevs.logging.LoggingBean" abstract="true">
		<property name="logger" ref="loggerFactory"/>
	</bean>
	
	<bean id="codingSchemeRegisteringListener" 
		class="org.lexevs.dao.database.service.listener.CodingSchemeRegisteringListener">
	</bean>
	
	<bean id="eventListenerBean" class="org.lexevs.dao.index.lucenesupport.LazyLoadMetaData" >
		<property name="systemVariables" ref="systemVariables"/>
		<property name="directoryCreator" ref="defaultLuceneDirectoryCreator"/>
		<property name="multiDirectoryFactory" ref="luceneMultiDirectoryFactory"/>
	</bean>
	
	<bean id="entityBatchingIndexCreator" class="org.lexevs.dao.index.indexer.EntityBatchingIndexCreator">
		<property name="entityService" ref="entityService"/>
		<property name="systemResourceService" ref="delegatingResourceManagingService"/>
		<property name="systemVariables" ref="systemVariables"/> 
		<property name="entityIndexer" ref="commonIndexLoaderCodeIndexer"/>
		<property name="indexDaoManager" ref="indexDaoManager"/>
		<property name="indexDirectoryFactory" ref="luceneMultiDirectoryFactory"/>
		<property name="codingSchemes" ref="concurrentCodingSchemeFactory"/>
		<property name="logger" ref="loggerFactory"/>
	</bean>
	
	<bean id="luceneMultiDirectoryFactory" class="org.lexevs.dao.index.lucenesupport.LuceneMultiDirectoryFactory">
		<property name="indexDirectory" ref="multiIndexLocation"/>
		<property name=	"luceneDirectoryCreator" ref="defaultLuceneDirectoryCreator"/>
	</bean>
	
	<bean id="concurrentCodingSchemeFactory" class="org.lexevs.dao.index.lucenesupport.LuceneMultiIndexMetaDataFactory"/>

	
	<bean id="defaultLexEvsIndexOperations"
		 class="org.lexevs.dao.index.operation.DefaultLexEvsIndexOperations" parent="loggingBean">
	 	<property name="indexCreator" ref="entityBatchingIndexCreator"/>
	 	<property name="indexRegistry" ref="multiIndexRegistry"/>
	 	<property name="concurrentMetaData" ref="concurrentCodingSchemeFactory"/>
	</bean>
	
	<bean id="luceneEntityIndexService" class="org.lexevs.dao.index.service.entity.SearchIndexAwareEntityIndexService">
		<property name="indexDaoManager" ref="indexDaoManager"/> 
		<property name="indexCreator" ref="entityBatchingIndexCreator"/>
		<property name="systemResourceService" ref="delegatingResourceManagingService"/>
		<property name="entityIndexer" ref="commonIndexLoaderCodeIndexer"/>
		<property name="concurrentMetaData" ref="concurrentCodingSchemeFactory"/>
		<property name="indexRegistry" ref="multiIndexRegistry"/>
		<property name="searchIndexService" ref="luceneSearchIndexService"/>
		<property name="registry" ref="registry"/>
	</bean>
	
	<bean id="luceneSearchIndexService" class="org.lexevs.dao.index.service.search.LuceneSearchIndexService">
		<property name="indexDaoManager" ref="indexDaoManager"/> 
		<property name="entityIndexer" ref="commonIndexLoaderCodeIndexer"/>
		<property name="indexCreator" ref="entityBatchingIndexCreator"/>
	</bean>
	
	<bean id="luceneMetadataIndexService" 
		class="org.lexevs.dao.index.service.metadata.LuceneMetadataIndexService">
		<property name="indexDaoManager" ref="indexDaoManager"/> 
		<property name="metadataIndexCreator" ref="luceneMetadataIndexCreator"/>
	</bean>
	
	<bean id="indexServiceManager" class="org.lexevs.dao.index.service.IndexServiceManager">
		<property name="entityIndexService" ref="luceneEntityIndexService"/>
		<property name="metadataIndexService" ref="luceneMetadataIndexService"/>
		<property name="searchIndexService" ref="luceneSearchIndexService"/>
	</bean>
	
	<bean id="indexDaoManager" class="org.lexevs.dao.index.access.IndexDaoManager">
		<property name="systemResourceService" ref="delegatingResourceManagingService"/>
		<property name="concurrentMetaData" ref="concurrentCodingSchemeFactory"/>
		<property name="indexRegistry" ref="multiIndexRegistry"/>
		<property name="entityDaos">
			<list>
				<ref bean="luceneIndexEntityDao"/>
				<ref bean="luceneEntity2009Dao"/>
			</list>
		</property>
		<property name="metadataDaos">
			<list>
				<ref bean="luceneMetadataDao"/>
			</list>
		</property>
		<property name="searchDaos">
			<list>
				<ref bean="luceneSearch2013Dao"/>
			</list>
		</property>
	</bean>
	
	<bean id="indexerService" class="org.lexevs.dao.index.factory.IndexerServiceFactory">
		<property name="systemVariables" ref="systemVariables"/> 
	</bean>
	
	<bean id="luceneMetadataDao" class="org.lexevs.dao.index.lucene.v2010.metadata.LuceneMetadataDao">
		<property name="baseMetaDataLoader" ref="baseMetaDataLoader"/>
		<property name="luceneIndexTemplate" ref="luceneMetadataIndexTemplate"/>
	</bean>

	<bean id="luceneMetadataIndexCreator" class="org.lexevs.dao.index.indexer.LuceneMetadataIndexCreator">
		<property name="baseMetaDataLoader" ref="baseMetaDataLoader"/>
		<property name="indexDaoManager" ref="indexDaoManager"/>
	</bean>
	
	<bean id="baseMetaDataLoader" class="org.lexevs.dao.index.metadata.BaseMetaDataLoader" />

	<bean id="luceneIndexEntityDao" class="org.lexevs.dao.index.lucene.v2010.entity.LuceneEntityDao">
		<property name="luceneIndexTemplate" ref="luceneMultiIndexTemplate"/>
		<property name="indexRegistry" ref="multiIndexRegistry"/>
	</bean>
	
	<bean id="luceneEntity2009Dao" class="org.lexevs.dao.index.lucene.v2009.entity.LuceneEntity2009Dao">
		<property name="indexRegistry" ref="multiIndexRegistry"/>
	</bean>
	
	<bean id="luceneSearch2013Dao" class="org.lexevs.dao.index.lucene.v2013.search.LuceneSearchDao">
		<property name="indexRegistry" ref="multiIndexRegistry"/>
	</bean>
	
	<bean id="commonIndexLoaderCodeIndexer" class="org.lexevs.dao.index.indexer.LuceneLoaderCodeIndexer">
		<property name="systemResourceService" ref="delegatingResourceManagingService"/>
		<property name="systemVariables" ref="systemVariables"/> 
		<property name="luceneEntityDao" ref="luceneIndexEntityDao"/>
	</bean>
	
	<bean id="abstractDirectoryFactory"
		class="org.lexevs.dao.index.lucenesupport.LuceneDirectoryFactory" abstract="true"/>
	
	<bean id="commonIndexDirectory" parent="abstractDirectoryFactory">
		<property name="indexDirectory" ref="commonIndexLocation" />
		<property name="luceneDirectoryCreator" ref="defaultLuceneDirectoryCreator"/>
		<property name="indexName">
			<util:constant static-field="org.lexevs.dao.index.factory.IndexLocationFactory.DEFAULT_SINGLE_INDEX_NAME"/>
		</property>
	</bean>
	
	<bean id="commonIndexLocation" 
		class="org.lexevs.dao.index.factory.IndexLocationFactory">
		<property name="systemVariables" ref="systemVariables"/> 
		<property name="indexName">
			<util:constant static-field="org.lexevs.dao.index.factory.IndexLocationFactory.DEFAULT_SINGLE_INDEX_NAME"/>
		</property>
	</bean>
	
	<bean id="multiIndexLocation" 
		class="org.lexevs.dao.index.factory.IndexLocationFactory">
		<property name="systemVariables" ref="systemVariables"/> 
		<property name="indexName"  value=""/>
	</bean>
	
	<bean id="metadataIndexDirectory" parent="abstractDirectoryFactory">
		<property name="luceneDirectoryCreator" ref="defaultLuceneDirectoryCreator"/>
		<property name="indexDirectory" ref="metadataIndexLocation" />
		<property name="indexName" value="MetaDataIndex" />
	</bean>
	
	<bean id="metadataIndexLocation" 
		class="org.lexevs.dao.index.factory.MetadataIndexLocationFactory">
		<property name="systemVariables" ref="systemVariables"/> 
	</bean>
		
	<bean id="searchIndexLocation" 
		class="org.lexevs.dao.index.factory.IndexLocationFactory">
		<property name="systemVariables" ref="systemVariables"/> 
		<property name="indexName" value="SearchIndex"/>
	</bean>
	
	<bean id="searchIndexDirectory" parent="abstractDirectoryFactory">
		<property name="luceneDirectoryCreator" ref="defaultLuceneDirectoryCreator"/>
		<property name="indexDirectory" ref="searchIndexLocation" />
		<property name="indexName" value="SearchIndex" />
	</bean>
	
	<bean id="defaultLuceneDirectoryCreator" 
		class="org.lexevs.dao.index.lucenesupport.DefaultLuceneDirectoryCreator"/>
	
	<bean id="multiReaderFactory" class="org.lexevs.dao.index.lucenesupport.MultiReaderFactory">
		<property name="concurrentMetaData" ref="concurrentCodingSchemeFactory"/>
	</bean>

	<bean id="luceneMetadataIndexTemplate" class="org.lexevs.dao.index.lucenesupport.BaseLuceneIndexTemplate">
		<property name="namedDirectory" ref="metadataIndexDirectory"/>
	</bean>
	
	<bean id="luceneMultiIndexTemplate" class="org.lexevs.dao.index.lucenesupport.MultiBaseLuceneIndexTemplate">
		<property name="metaDirectories" ref="concurrentCodingSchemeFactory"/>
		<property name="indexReader" ref="multiReaderFactory"/>
	</bean>

	<bean id="multiIndexRegistry" class="org.lexevs.dao.index.indexregistry.MultiIndexRegistry">
		<property name="systemVariables" ref="systemVariables"/> 
		<property name="systemResourceService" ref="delegatingResourceManagingService"/>
		<property name="luceneIndexTemplate" ref="luceneMetadataIndexTemplate"/>
		<!--  property name="searchLuceneIndexTemplate" ref="luceneSearchIndexTemplate"/-->
		<property name="luceneDirectoryCreator" ref="defaultLuceneDirectoryCreator"/>
		<property name="concurrentMetaData" ref="concurrentCodingSchemeFactory"/>
		
	</bean>
	
	<bean id="cacheConfigLocationFactory" class="org.lexevs.cache.CacheConfigLocationFactory">
		<property name="systemVariables" ref="systemVariables"/> 
	</bean>

	
	</beans>
